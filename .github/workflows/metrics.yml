name: Metrics
on:
  schedule: [{cron: "0 0 * * *"}]
  workflow_dispatch:
  push: {branches: ["master", "main"]}

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # 1. 语言详细分析 (All-time)
      - name: Languages
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.languages.indepth.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_ignored: html, css
          plugin_languages_indepth: yes
          plugin_languages_details: lines, percentage
          plugin_languages_limit: 0
          repositories_forks: no
          plugin_languages_analysis_timeout: 60

      # 2. 互动表情
      - name: Reactions
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.reactions.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_reactions: yes
          plugin_reactions_limit: 100

      # 3. Issue/PR 跟进 (All-time, 包含归档)
      - name: Followup
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.followup.indepth.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_followup: yes
          plugin_followup_indepth: yes
          plugin_followup_archived: yes
          plugin_followup_sections: user

      # 4. 置顶仓库
      - name: Pinned Repositories
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.repositories.pinned.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_repositories: yes
          plugin_repositories_pinned: 6

      # 5. WakaTime (需配置 WAKATIME_TOKEN)
      - name: WakaTime
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.wakatime.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_wakatime: yes
          plugin_wakatime_token: ${{ secrets.WAKATIME_TOKEN }}
          plugin_wakatime_days: 7

      # 6. 获得的 Star
      - name: Stars
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.stars.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_stars: yes
          plugin_stars_limit: 3

      # 7. 3D 提交日历
      # 只能显示最近 365 天 (full-year)，无法精确裁剪到 6月，但 365天 肯定包含 6月。
      - name: Isometric Calendar
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.isocalendar.fullyear.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_isocalendar: yes
          # 选项只有 full-year (365天) 或 half-year (180天)
          # 选 full-year 可以覆盖到 2025年6月
          plugin_isocalendar_duration: half-year

      # 8. 全年普通日历
      # 显示最近的 2 个年份 (2026 和 2025)
      - name: Calendar
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.calendar.full.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_calendar: yes
          # 限制为 2 年 (当前年 + 去年)
          # 这样会显示 2025 和 2026 整年
          plugin_calendar_limit: 2
